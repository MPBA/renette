{% extends 'base.html' %}
{% load static %}
{% block extrahead %}

      <script type="text/javascript">

        function humanFileSize(bytes, si) {
            var thresh = si ? 1000 : 1024;
            if(bytes < thresh) return bytes + ' B';
            var units = si ? ['kB','MB','GB','TB','PB','EB','ZB','YB'] : ['KiB','MiB','GiB','TiB','PiB','EiB','ZiB','YiB'];
            var u = -1;
            do {
                bytes /= thresh;
                ++u;
            } while(bytes >= thresh);
            return bytes.toFixed(1)+' '+units[u];
        };

       jQuery(document).ready(function(){

          $("#load_ex_data").click(function(){
            jQuery.get('/media/test.tsv', function(data){
                var testdata = data;
                 $("#exampleData").text("");
                 $("#exampleData").text(testdata);
            });


          });

          $('input:file[multiple]').change(
            function(e){
                console.log(e.currentTarget.files);
                var numFiles = e.currentTarget.files.length;
                    for (i=0;i<numFiles;i++){
                        fileSize = parseInt(e.currentTarget.files[i].size, 10)/1024;
                        filesize = Math.round(fileSize);

                        $('<li />').text(e.currentTarget.files[i].name).appendTo($('#output'));
                        $('<span />').addClass('filesize').text('(' + filesize + 'kb)').appendTo($('#output li:last'));
                    }
            });

           $("#reset_form").click(function(){
               $("#output").find('li').remove();
            });

        });



    </script>
    <script type="text/javascript" src="{% static 'jquery-upload/js/vendor/jquery.ui.widget.js' %}"></script>
    <script type="text/javascript" src="{% static 'jquery-upload/js/jquery.iframe-transport.js' %}"></script>
    <script type="text/javascript" src="{% static 'jquery-upload/js/jquery.fileupload.js' %}"></script>
    <script>
        /*jslint unparam: true */
        /*global window, $ */
        $(function () {
            'use strict';
            // Change this to the location of your server-side upload handler:
            var url = '/engine/multiuploader/';
            $('#fileupload').fileupload({
                url: url,
                dataType: 'json',
                done: function (e, data) {
                    $.each(data.result.files, function (index, file) {
                        $('<p/>').text(file.name + " [" + humanFileSize(file.size, 1024) + "]").appendTo('#files');
                    });

                },
                progressall: function (e, data) {
                    var progress = parseInt(data.loaded / data.total * 100, 10);
                    $('#progress .progress-bar').css(
                        'width',
                        progress + '%'
                    );
                }
            }).prop('disabled', !$.support.fileInput)
              .parent().addClass($.support.fileInput ? undefined : 'disabled')
              .bind('fileuploadfail', function (e, data){
                        console.log(data)
                         $('<p/>').text(data.errorThrown + ': ' + data.jqXHR.responseText).appendTo('#files');
                    });
        });
    </script>
{% endblock extrahead %}

{% block container %}
<div class="row row-offcanvas row-offcanvas-right">

        <div class="col-md-12 col-md-9">
          <div class="row">
            <h1>Network Distance [Step 1/3]</h1>
            <div class="col-6">
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                        <p {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
            </div>
            {% endfor %}
            {% endif %}
              <h3>Load your files</h3>
              <form method="POST" enctype="multipart/form-data" role="form" class="form-horizontal" action="{% url 'network_distance_2' %}">
                  {% csrf_token %}

                  <div class="fileinput fileinput-new" data-provides="fileinput">
                      <div class="input-group">
                        <span class="input-group-addon btn btn-default btn-file"><input id="fileupload" type="file" name="files[]" multiple></span>
                          <div class="form-control uneditable-input span3" data-trigger="fileinput">
                            <!-- The container for the uploaded files -->
                        <div id="files" class="files"></div>
                        </div>
                      </div>

                      <div class="checkbox-inline">
                        <label>
                          <input type="checkbox" name="exclude_col_header"> Exclude Columns Header
                        </label>
                      </div>
                      <div class="checkbox-inline">
                        <label>
                          <input type="checkbox" name="exclude_row_header"> Exclude Rows Header
                        </label>
                      </div>
                  </div>
                  <!-- The global progress bar -->
                    <div id="progress" class="progress">
                        <div class="progress-bar progress-bar-success"></div>
                    </div>


                  <input type="submit" class="btn btn-go" name="Upload" value="Go >>">
                  <input type="reset" value="Reset" class="btn btn-danger" id="reset_form">
              </form>

            </div><!--/span-->
            <hr>
            <div class="col-6">
              <h3>Run tasks with Example Data</h3>
              <form role="form" class="form-horizontal">
                  <div class="form-group">
                    <label for="exampleInputEmail1"></label>
                    <div class="col-sm-9">
                        <textarea class="form-control" id="exampleData" placeholder="Enter data ..." rows="7"></textarea>
                    </div>
                    <div class="col-sm-offset-6">
                        <p style="text-align: justify">
                        You can copy and paste your source data into the textarea or click <a href="#" id="load_ex_data">here</a> to load demo data.
                        <br>Start the task just clicking the Go button! Enjoy
                        </p>
                    </div>
                  </div>
                    <button type="submit" class="btn btn-go">Go >></button>
              </form>
            </div><!--/span-->


          </div><!--/row-->
        </div><!--/span-->
        {% include "navigation.html" %}
</div><!--/row-->
{% endblock container %}



